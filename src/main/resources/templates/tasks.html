<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tasks</title>
    <link rel="stylesheet" href="/css/project-manager.css">
    <link rel="stylesheet" href="/css/time-progress.css">
    <link rel="stylesheet" href="/css/profile.css">
</head>
<body class="page page-list">

    <!-- Logo -->
    <div class="app-logo">
        <img src="/img/ProjectManager.png" alt="Project Manager Logo">
    </div>

    <!-- Top-right buttons -->
    <div class="header-actions">
        <button onclick="copyEmail()" class="btn btn-primary btn-header">Contact</button>
        <a th:href="@{/subproject/list/{projectId}(projectId=${subProject.projectId})}"
           class="btn btn-danger btn-header">Back</a>
    </div>

    <!-- Page title -->
    <h1 class="page-title">
        <span>Tasks</span>
    </h1>

    <!-- Main content panel -->
    <div class="content-panel">

        <!-- Panel header with subproject name + total time + Add button -->
        <div class="content-panel__header">
            <div class="content-panel__title">
                <span th:text="${subProject.name}">SubProject Name</span> -
                Total time used: <span th:text="${totalActualTime}">0</span>h
            </div>

            <div class="content-panel__actions">
                <a th:href="@{/task/add/{subProjectId}(subProjectId=${subProject.subProjectId})}"
                   class="btn btn-primary">
                    Add Task
                </a>
            </div>
        </div>

        <!-- Tasks table -->
        <table class="data-table">
            <thead>
                <tr>
                    <th></th> <!-- Row number -->
                    <th>Title</th>
                    <th>Description</th>
                    <th>Assigned Team</th>
                    <th>Status</th>
                    <th>Time Progress</th>
                    <th>Priority</th>
                    <th>Start date</th>
                    <th>End date</th>
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="task, iterStat : ${tasks}">
                    <td th:text="${iterStat.count}"></td>
                    <td>
                        <a th:href="@{/subtask/list/{taskId}(taskId=${task.taskId})}"
                            th:text="${task.name}">Task Name</a>
                    </td>
                    <td th:text="${task.description}">Description</td>
                    <td>Team</td>
                    <td th:text="${task.status}">Status</td>

                    <!-- Time progress indicator -->
                    <td>
                        <div class="time-progress time-progress--small">
                            <div class="time-progress__clock">
                                <svg viewBox="0 0 50 50" class="time-progress__circle">
                                    <circle cx="25" cy="25" r="20" class="time-progress__circle-bg"/>
                                    <circle cx="25" cy="25" r="20"
                                            class="time-progress__circle-progress"
                                            th:classappend="${task.actualTime > task.estimatedTime ? 'status-over' : (task.actualTime > task.estimatedTime * 0.7 ? 'status-warning' : 'status-good')}"
                                            th:attr="stroke-dasharray='125.6', stroke-dashoffset=${125.6 - (125.6 * (task.estimatedTime > 0 ? (task.actualTime * 1.0 / task.estimatedTime) : 0))}"/>
                                </svg>
                                <div class="time-progress__text"
                                     th:text="${task.estimatedTime > 0 ? #numbers.formatInteger((task.actualTime * 100.0 / task.estimatedTime), 0) + '%' : '0%'}">0%</div>
                            </div>
                            <div class="time-progress__details">
                                <span th:text="${task.actualTime}">0</span>h used /
                                <strong th:text="${task.estimatedTime}">0</strong>h est.
                            </div>
                        </div>
                    </td>

                    <td th:text="${task.priority}">Priority</td>
                    <td th:text="${task.startDate}">Start Date</td>
                    <td th:text="${task.endDate}">End Date</td>
                    <td class="text-right">
                        <a th:href="@{/task/edit/{taskId}(taskId=${task.taskId})}"
                           class="btn btn-primary">
                            Edit
                        </a>
                        <a th:href="@{/task/delete/{taskId}(taskId=${task.taskId})}"
                           class="btn btn-danger">
                            Delete
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast"></div>

    <script src="/js/contact.js"></script>
</body>
</html>
